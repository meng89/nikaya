\setuppapersize [$size]

\enableregime[utf]
\mainlanguage[cn]
\language[cn]
\setscript[hanzi] % hyphenation

%%%%%%%
% 字体
\usetypescriptfile[type-imp-myfonts]
\startmode [tc]
  \usetypescript[tcfonts]
  \setupbodyfont[tcfonts,rm,12pt]
\stopmode
\startmode [sc]
  \usetypescript[scfonts]
  \setupbodyfont[scfonts,rm,12pt]
\stopmode
% 字体
%%%%%%%

\usecolors[crayola]
%\usecolors[ral]


%%%%%%%%%%%%
% 页脚页眉
\setupheader
  [text]
  [before={\startframed[frame=off,bottomframe=on,framecolor=black,]},
   after={\stopframed},
  ]
\setupfooter
  [text]
  [before={\startframed[frame=off,bottomframe=off,topframe=on,framecolor=black,]},
   after={\stopframed},
  ]
\setupheadertexts[]
%\setupheadertexts[{\tf\bf\ss \somenamedheadnumber{chapter}{current}. \getmarking[chapter]}][]
\setupfootertexts[]
\setupfootertexts[][{\tfa \it \pagenumber}]
% 页脚页眉
%%%%%%%%%%%


%%%%%%%%%%%%%%%
% PDF 属性信息
\setupinteraction[focus=standard] % 重要功能！添加上后才能连接到位置！
\setupinteraction[state=start,style=normal]
\setupinteraction[
    title={$title},
    author={$author},
    keyword={$keyword},
    creator={https://github.com/meng89/nikaya},
]

% PDF 属性信息
%%%%%%%%%%%%%%%


%%%%%%%%%%%%
% PDF书签
%\definelist[tobias]

%\placebookmarks[appendix,part,chapter,section,subsection,tobias][chapter][number=no]

\placebookmarks[title,subject,subsubject,subsubsubject,subsubsubsubject,subsubsubsubsubject]
\setuphead[title][incrementnumber=list]
\setuphead[subject][incrementnumber=list]
\setuphead[subsubject][incrementnumber=list]
\setuphead[subsubsubject][incrementnumber=list]
\setuphead[subsubsubsubject][incrementnumber=list]
\setuphead[subsubsubsubsubject][incrementnumber=list]


\setupinteractionscreen[option=bookmark]
\enabledirectives[references.bookmarks.preroll]

\enabledirectives[backend.pdf.fixhighlight]

%\lettertilde
\define[3]\pian{\part[title=#1,bookmark={#1(#2~#3)},]}
\define[2]\xiangying{\chapter[title=#2, bookmark=#1. #2,]}
\define[3]\pin{\section[title=#1,bookmark=#1(#2~#3)]}
\define[4]\sutta{\subsection[reference=SN.\somenamedheadnumber{chapter}{current}.#1,
     title={\goto{{\startlua if #1==#2 then context("#1") else context("#1\\lettertilde#2") end \stoplua}. #3}[url(#4)]}]}


% 绿
\define[1]\suttaref{\setupinteraction[color=PineGreen]\goto{#1}[#1]}
% 黄
\define[2]\ccchref{\setupinteraction[color=FuzzyWuzzy]\goto{#1}[url(#2)]}
% 蓝
\define[2]\twnr{\setupinteraction[color=MidnightBlue]\goto{#1}[#2]}


\define[1]\noteTitle{\part[title=#1]}


\define[1]\subnoteref{\textreference[#1]{\null}}

%%%%%%%
%
\define[1]\NoteSubKeyHead{{\it #1}}
\define[1]\NoteKeywordAgamaHead{{#1}}
\define[1]\NoteKeywordNikayaHead{{#1}}

\define[1]\NoteSubEntryKey{{\sl #1}}
\define[1]\NoteKeywordAgama{{#1}}
\define[1]\NoteKeywordNikaya{{#1}}
\define[1]\NoteKeywordBhikkhuBodhi{{#1}}
\define[1]\NoteKeywordBhikkhuNanamoli{{#1}}


\definecolor[pdfhighlight:莊春江][r=1,g=1,b=1]



\useexternalfigure[cover][$cover_image]
\defineoverlay[cover][{\externalfigure[cover]}]

\startsetups Background:cover
\setupbackgrounds[page][background=cover]
\stopsetups

\startsetups Background:off
% 只要把 background 设置成无法识别的，就会没有背景。
\setupbackgrounds[page][background=laskjfsalkfjasldfkjlaksfjdaslkfjlasdkfjaslkfjaslkfjslkdjflaskjdf]
\stopsetups

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\startdocument

\setups[Background:cover]

\startstandardmakeup

\stopstandardmakeup

\setups[Background:off]

\input{fanli.tex}


$homage

\input{$suttas}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 附录一：注解

\setupheader
  [text]
  [before={\startframed[frame=off,bottomframe=on,topframe=off,framecolor=black,]},
   after={\stopframed},
  ]
\setupfooter
  [text]
  [before={\startframed[frame=off,bottomframe=off,topframe=on,framecolor=black,]},
   after={\stopframed},
  ]


\input{readme.tex}

\stopdocument
